<title>${HTML_TITLE}</title>
<link rel="shortcut icon" href="${STATIC_URL}images/bk_fta_solutions.png" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="${STATIC_URL}css/index.css?v=${STATIC_VERSION}" />
<div class="doc-main">
    <h3 class="doc-page-title">故障自愈套餐大全</h3>
    <!-- 组合套餐S -->
    <div class="doc-item" id="diy">
        <h3>组合套餐</h3>
        <p>组合套餐，顾名思义就是把该业务下的套餐和官方通用套餐组合起来使用。</p>
        <ul>
            <li>
                <h5>具体操作:</h5>
                <p>按照配置的流程顺序执行套餐</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>当单一的套餐无法满足故障恢复流程时，将套餐串起来</p>
            </li>
        </ul>
    </div>
    <!-- 组合套餐E -->

    <!-- 按时间汇总后通知S -->
    <div class="doc-item" id="collect">
        <h3>按时间汇总后通知</h3>
        <ul>
            <li>
                <h5>具体操作:</h5>
                <p>根据配置按一定维度收敛后，发送通知给用户</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>对于一些大量出现的告警，如单机性能告警/流量告警等，可以用此套餐收敛后发送通知。</p>
            </li>
            <li>
                <h5>参数说明:</h5>
                <p>时间段和告警数必须填一个。按时间段汇总：从收到第一条告警开始计时，到规定时间后结束。按告警数汇总：从收到第一条告警开始计数，到规定数量后结束。少于多少条不通知：选择时间段汇总时，如果到时间后，告警数量少于指定数量，就不发通知。可以选择是否将告警存档在自愈，推荐不保存，直接在对接的监控系统中查看历史告警，以免告警列表页面被无效告警淹没。</p>
            </li>
            <li>
                <h5>案例:</h5>
                <p>希望累计出现3条告警通知一次。参数为 0，0，3</p>
                <p>希望有告警产生就每20分钟汇总通知一次。参数为20，0，0</p>
                <p>希望每30分钟内累计出现5条以上告警通知一次。参数为 30，5，0</p>
                <p>希望30分钟汇总一次，或者累计出现10条告警就马上通知。参数为 30，0，10</p>
            </li>
        </ul>
    </div>
    <!-- 按时间汇总后通知E -->

    <!-- 作业平台S -->
    <div class="doc-item" id="ijobs">
        <h3>作业平台</h3>
        <p>调用 蓝鲸作业平台，作业平台脚本需要按照一定规范来。</p>
        <ul>
            <li>
                <h5>具体操作:</h5>
                <p>调用 作业平台作业</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>希望在机器上执行脚本的故障恢复操作，如拉起进程等</p>
            </li>
            <li>
                <h5>参数说明:</h5>
                <p>通过选择框选择 作业平台作业;</p>
                <p>可以自定义传入 作业平台 的参数(不填默认传入故障IP);</p>
                <p>可以通过作业平台 脚本获取自愈变量来在其他套餐中使用</p>
            </li>
        </ul>
    </div>
    <!-- 作业平台E -->

    <!-- 腾讯云重启S -->
    <div class="doc-item" id="uwork">
        <h3>腾讯云重启</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>调用腾讯云重启接口</p>
            </li>
            <li>
                <h5>使用场景： </h5>
                <p>比如服务器出现“PING不可达”告警，需重启服务器</p>
            </li>
        </ul>
    </div>
    <!-- 腾讯云重启E -->

    <!-- 腾讯云重启后执行作业平台S -->
    <div class="doc-item" id="uwork_then_ijobs">
        <h3>腾讯云重启后执行作业平台</h3>
        <p></p>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>先执行腾讯云重启 ，然后执行作业平台</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>比如服务器出现“PING不可达”告警，需重启服务器后拉起进程</p>
            </li>
        </ul>
    </div>
    <!-- 腾讯云重启后执行作业平台E -->

    <!-- 获取故障机备机S -->
    <div class="doc-item" id="get_bak_ip">
        <h3>获取故障机备机</h3>
        <p>根据 配置平台的配置 属性获取备机。许多故障替换操作都依赖于此套餐。</p>
        <p>除了通过这个套餐获取备机外，也可以通过 作业平台来获取备机，只要使用 作业平台 套餐获取变量为 ip_bak 的参数即可。</p>
        <ul>
            <li>
                <h5>具体操作:</h5>
                <p>根据配置，在 配置平台 指定的 Set 与 App Module 中，查找指定属性与故障机相同的机器。将所有符合条件的机器 IP 通过微信让运维审批选择。此后备机 IP 就能通过变量在其他套餐中获取。</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>在组合套餐中调用故障替换的操作套餐前必须先调用过此套餐</p>
            </li>
        </ul>
    </div>
    <!-- 获取故障机备机E -->

    <!-- 通知或审批S -->
    <div class="doc-item" id="notice">
        <h3>通知或审批</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>调用不同的接口发送通知或审批（发送微信失败会改为短信，发送短信失败则发微信，邮件通知接口调用失败将不做处理）</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>一般用户组合套餐中；通知，自定义消息发送到微信等平台；审批，执行服务器故障替换流程时，让运维审批是否执行替换，降低风险</p>
            </li>
        </ul>
    </div>
    <!-- 通知或审批E -->

    <!-- 暂停等待S -->
    <div class="doc-item" id="sleep">
        <h3>暂停等待</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>暂停一定时间</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>重启操作后 Agent可能还没准备好，可以等待一定时间后再继续后面的流程</p>
            </li>
        </ul>
    </div>
    <!-- 暂停等待E -->

    <!-- 自定义收敛防御S -->
    <div class="doc-item" id="convergence">
        <h3 自定义收敛防御</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>在指定时间内，出现过指定告警数量的相同IP，相同告警类型，将会收敛次条告警</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>想添加某些异常防御条件的时候。大部分需求故障自愈的收敛功能就能满足</p>
            </li>
        </ul>
    </div>
    <!-- 自定义收敛防御E -->

    <!-- 『快捷』套餐S -->
    <div class="doc-item">
        <h3> 『快捷』套餐</h3>
        <p>每个业务默认都会有一批可以选择的套餐，用户几乎不需要对其做任何配置可以直接使用。对于这种套餐，我们用称为『快捷』套餐。</p>
        <p>(部分『快捷』套餐只能在组合套餐中选用)</p>

    </div>
    <!-- 『快捷』套餐E -->

    <!-- 『快捷』配置平台拷贝故障机属性到备机(得先调选择备机)S -->
    <div class="doc-item">
        <h3> 『快捷』配置平台拷贝故障机属性到备机(得先调选择备机)</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>调用 配置平台 替换接口，</p>
                <p>将替换机转移到与故障机相同的模块下（包括属于故障机多个模块的情况）；</p>
                <p>拷贝故障机的标准属性到替换机；</p>
                <p>拷贝故障机的自定义属性到替换机；</p>
                <p>拷贝故障机的进程端口到替换机；</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>故障机切换后拷贝故障机 CC 信息到备机</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』配置平台拷贝故障机属性到备机(得先调选择备机)E -->

    <!-- 『快捷』发送审核(微信+短信)S -->
    <div class="doc-item">
        <h3> 『快捷』发送审核(微信+短信)</h3>
        <p>发送微信与短信进行审批，内容为：</p>
        <p>“【故障自愈】即将执行（\({组合套餐中下一个步骤的名称}）（\){业务名称}、模块为\({模块}、 IP为\){IP}），请审核！”</p>
        <ul>
            <li>
                <h5>使用场景：</h5>
                <p>当下一步执行的操作希望人工审批是否要继续执行的时候，在步骤前调用。</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』发送审核(微信+短信)E -->

    <!-- 『快捷』发送通知(微信+邮件)S -->
    <div class="doc-item">
        <h3> 『快捷』发送通知(微信+邮件)</h3>
        <p>【故障自愈】执行（\({组合套餐中上一个步骤的名称}）\){组合套餐中上一个步骤的执行结果}（\({业务名称}、模块为\){模块}、 IP为{IP}），请关注！</p>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>发送微信和邮件通知，内容为：</p>
                <p>【故障自愈】执行（\({组合套餐中上一个步骤的名称}）\){组合套餐中上一个步骤的执行结果}（\({业务名称}、模块为\){模块}、 IP为{IP}），请关注！</p>
            </li>
            <li>
                <h5>使用场景：</h5>
                <p>希望执行完某个步骤后，发送成功或者失败后的结果通知。</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』发送通知(微信+邮件)E -->

    <!-- 『快捷』发送通知(微信+邮件+短信)S -->
    <div class="doc-item">
        <h3> 『快捷』发送通知(微信+邮件+短信)</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>发送微信和邮件外加短信通知，其余同上</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』发送通知(微信+邮件+短信)E -->

    <!-- 『快捷』发送通知(电话)S -->
    <div class="doc-item">
        <h3> 『快捷』发送通知(电话)</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>发送电话通知，其余同上</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』发送通知(电话)E -->

    <!-- 『快捷』后续处理对象故障机与备机互换(得先调选择备机)S -->
    <div class="doc-item">
        <h3> 『快捷』后续处理对象故障机与备机互换(得先调选择备机)</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>调用此套餐后，在组合套餐的后续流程中，操作对象将会替换。流程默认都是对故障机进行操作，调用一次后将会默认对备机进行操作。再调用一次，则恢复原状。</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>例如当获取选定的备机后，想对备机进行初始化操作，那么这时候就要先调用一次此套餐，再调用 初始化。初始化后，又想把故障机移动到 配置平台 的故障机模块，那么就又要调用一次此套餐，然后再调用 配置平台移动模块。</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』后续处理对象故障机与备机互换(得先调选择备机)E -->

    <!-- 『快捷』强制时间同步S -->
    <div class="doc-item">
        <h3> 『快捷』强制时间同步</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>调用一个 作业平台 作业，强制时间同步</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』强制时间同步E -->

    <!-- 『快捷』标记组合套餐为基本成功S -->
    <div class="doc-item">
        <h3> 『快捷』标记组合套餐为基本成功</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>标注自愈的处理结果为基本成功</p>
            </li>
            <li>
                <h5>使用场景:</h5>
                <p>自愈的收敛策略为如果处理的套餐相同，那么如果第一个告警处理成功，后面的告警将会被收敛，失败的话则重新处理。</p>
                <p>因此，可以在组合套餐中在某些核心步骤处理完后，调用次套餐来标注流程为基本成功，不让一些周边操作影响整个流程，使得一些核心操作被重复执行。</p>
                <p>例如对于 PING不可达告警，可以在 腾讯云重启成功后标注基本成功，这样即使后续的步骤失败，机器也不会被再次重启。</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』标记组合套餐为基本成功E -->

    <!-- 『快捷』确认主机Ping不通(Ping通返回失败)S -->
    <div class="doc-item">
        <h3> 『快捷』确认主机Ping不通(Ping通返回失败)</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>在故障自愈的机器上Ping 一次目标机器的内网IP，Ping得通返回跳过(走组合套餐失败分支)，Ping 不通返回成功状态</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』确认主机Ping不通(Ping通返回失败)E -->

    <!-- 『快捷』直接保存无处理S -->
    <div class="doc-item">
        <h3> 『快捷』直接保存无处理</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>收到告警后直接保存到自愈数据库，不通知也不处理</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』直接保存无处理E -->

    <!-- 『快捷』不处理，仅触发通知S -->
    <div class="doc-item">
        <h3> 『快捷』不处理，仅触发通知</h3>
        <ul>
            <li>
                <h5>具体操作：</h5>
                <p>收到告警后直接保存到自愈数据库，触发接入告警时的通知策略</p>
            </li>
        </ul>
    </div>
    <!-- 『快捷』不处理，仅触发通知E -->

</div>

<script type="text/javascript" src="${STATIC_URL}diy/js/jquery-1.11.3.min.js?v=${STATIC_VERSION}"></script>
<script type="text/javascript">
    var strId = window.location.hash;
    var topH = eval('$("'+strId+'").offset().top');
    $(window).scrollTop(topH)
</script>
